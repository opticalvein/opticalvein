<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GALLERY</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .image-gallery {
      display: grid;
      grid-template-columns: repeat(4, 140px);
      gap: 36px 60px;
      margin: 60px 320px;
      max-width: none;
    }

    .gallery-item {
      position: relative;
      width: 100%;
      height: 140px;
      overflow: hidden;
      border: 2px solid rgba(255, 255, 255, 0.9);
      cursor: pointer;
    }

    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .page-subheader {
      font-size: 1.5rem;
      color: cornflowerblue;
      letter-spacing: 2px;
      margin-top: 230px;
      margin-left: 320px;
      padding: 8px 0;
      position: relative;
      display: inline-block;
    }

    .page-subheader::before,
    .page-subheader::after {
      content: '';
      position: absolute;
      left: -40px;
      width: calc(100% + 80px);
      border-image: linear-gradient(to right, transparent, rgba(255,255,255,0.7), transparent);
      border-image-slice: 1;
    }

    .page-subheader::before {
      top: 0;
      border-top: 2px solid;
    }

    .page-subheader::after {
      bottom: 0;
      border-bottom: 2px solid;
    }

    .pagination-controls {
      margin-top: 36px;
      text-align: center;
      font-family: serif;
      color: rgba(255,255,255,0.85);
      font-size: 1.1rem;
    }

    .pagination-line {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      font-size: 1.2rem;
    }

    .pagination-controls button {
      background: none;
      border: none;
      color: rgba(255,255,255,0.8);
      font-size: 1.4rem;
      cursor: pointer;
      padding: 4px 8px;
      transition: color 0.2s ease;
      line-height: 1;
    }

    .pagination-controls button:hover:not(:disabled) {
      color: white;
    }

    .pagination-controls button:disabled {
      opacity: 0.3;
      cursor: default;
    }
  </style>
</head>
<body>
  <!-- SITE HEADER -->
  <header class="fixed-header">
    <nav class="nav-links">
      <a href="about.html">about</a>
      <a href="atelier.html">atelier</a>
      <a href="gallery.html">gallery</a>
      <a href="contact.html">contact</a>
    </nav>
    <div class="site-title">
      <a href="index.html" class="home-link">optical♱vein</a>
      <img src="images/eye.gif" alt="Animated GIF" class="title-gif" />
    </div>
    <nav class="sub-nav-links">
      <a href="boudoir.html">boudoir</a>
      <a href="entries.html">entries</a>
      <a href="collections.html">collections</a>
      <a href="links.html">links</a>
    </nav>
  </header>

  <!-- COLLAPSIBLE NAV ON LEFT -->
  <nav class="left-sub-nav">
    <details class="dropdown">
      <summary>photography</summary>
      <ul class="dropdown-content">
        <li><a href="gallery.html?view=digital">digital</a></li>
        <li><a href="gallery.html?view=film">film</a></li>
      </ul>
    </details>

    <details class="dropdown">
      <summary>artworks</summary>
      <ul class="dropdown-content">
        <li><a href="gallery.html?view=traditional">traditional</a></li>
        <li><a href="gallery.html?view=computer-graphics">computer graphics</a></li>
        <li><a href="gallery.html?view=multimedia">multimedia</a></li>
      </ul>
    </details>

    <details class="dropdown">
      <summary>scans</summary>
      <ul class="dropdown-content">
        <li><a href="gallery.html?view=magazines">magazines</a></li>
        <li><a href="gallery.html?view=books">books</a></li>
        <li><a href="gallery.html?view=cds-dvds">cds & dvds</a></li>
      </ul>
    </details>

    <details class="dropdown">
      <summary>publications</summary>
      <ul class="dropdown-content">
        <li><a href="gallery.html?view=zines">zines</a></li>
        <li><a href="gallery.html?view=prints">prints</a></li>
      </ul>
    </details>
  </nav>

  <!-- MAIN PAGE CONTENT -->
  <main>
    <div class="page-subheader" id="gallery-header">gallery</div>
    <section class="image-gallery" id="gallery-content"></section>
  </main>

  <footer class="site-footer">
    &copy; 2024–2025 optical♱vein. all rights reserved.
  </footer>

  <script>
    const params = new URLSearchParams(window.location.search);
    const view = params.get("view");
    const pageParam = parseInt(params.get("page")) || 1;

    const header = document.getElementById("gallery-header");
    const content = document.getElementById("gallery-content");

    const IMAGES_PER_PAGE = 12;
    let currentPage = pageParam;

    function labelFromView(viewName) {
      let label = viewName.replace(/-/g, " ");
      if (label === "cds dvds") label = "cds & dvds";
      return label;
    }

    async function detectImageCount(viewName, maxLimit = 100) {
      for (let i = 1; i <= maxLimit; i++) {
        const image = new Image();
        image.src = `images/${viewName}${i}.jpg`;
        const exists = await new Promise((resolve) => {
          image.onload = () => resolve(true);
          image.onerror = () => resolve(false);
        });
        if (!exists) return i - 1;
      }
      return maxLimit;
    }

    async function paginate(viewName) {
      const label = labelFromView(viewName);
      header.textContent = label;
      content.scrollIntoView({ behavior: "smooth", block: "start" });

      const total = await detectImageCount(viewName);
      const totalPages = Math.ceil(total / IMAGES_PER_PAGE);

      const start = (currentPage - 1) * IMAGES_PER_PAGE;
      const end = Math.min(start + IMAGES_PER_PAGE, total);

      content.innerHTML = Array.from({ length: end - start }, (_, i) => {
        const index = start + i + 1;
        return `
          <a href="images/${viewName}${index}.jpg" class="gallery-item" target="_blank">
            <img src="images/${viewName}${index}.jpg" alt="${label} ${index}">
          </a>
        `;
      }).join("");

      if (totalPages > 1) {
        const nav = document.createElement("div");
        nav.className = "pagination-controls";
        nav.innerHTML = `
          <div class="pagination-line">
            <button id="prevBtn" ${currentPage === 1 ? "disabled" : ""}>☜</button>
            <span>${currentPage} / ${totalPages}</span>
            <button id="nextBtn" ${currentPage === totalPages ? "disabled" : ""}>☞</button>
          </div>
        `;
        content.appendChild(nav);

        document.getElementById("prevBtn")?.addEventListener("click", () => {
          if (currentPage > 1) {
            currentPage--;
            paginate(viewName);
          }
        });

        document.getElementById("nextBtn")?.addEventListener("click", () => {
          if (currentPage < totalPages) {
            currentPage++;
            paginate(viewName);
          }
        });
      }

      // Update URL
      const newParams = new URLSearchParams(window.location.search);
      newParams.set("page", currentPage);
      history.replaceState(null, "", `?view=${viewName}&${newParams.toString()}`);
    }

    if (view) {
      paginate(view);
    } else {
      header.textContent = "gallery";
      content.innerHTML = "";
    }
  </script>
</body>
</html>